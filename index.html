<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>跳转</title>
	</head>
	<body>
        <a href='zhbservice://zhbservice.com/goapp?openby:zhbservice={"action":"go.productDetail","params":{"productId":"e37a113be8eb47f7b1d9e332f9fc142b"},"sign":"848ef44c3d2745359aeccd96cadbdee5"}' style="display:block;height:1000;width:2000;background:red;text-align:center;font-size:100px;" id="test">商品详情</a>
	</body>
    <script type="text/javascript">
        function cookie(name) {
            var cookies = document.cookie,
            cookieVal;
            
            if (cookies) {
                cookies = cookies.split(';');
                cookies.forEach(function (c) {
                                if (c.indexOf(name) > -1) {
                                cookieVal = decodeURIComponent($.trim(c.replace(name + '=', '')));
                                return;
                                }
                                });
            }
            
            return cookieVal;
        }
    
    function queryString() {
        var vars = {},
        hash,
        i;
        var hashes = window.location.search.slice(1).split('&');
        
        for (i = 0; i < hashes.length; i++) {
            hash = hashes[i].split('=');
            vars[hash[0]] = hash[1];
        }
        return vars;
    }
    
    
    function xhrGet(url, cb) {
        var conn = (window.XMLHttpRequest) ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
        conn.onreadystatechange = function () {
            if (conn.readyState == 4 && conn.status == 200) {
                cb(conn.responseText)
            }
        };
        conn.open("GET", url, true);
        conn.send();
    }
    
    window.cookie = cookie;
    
    var url = 'zhbservice://zhbservice.com/goapp?openby:zhbservice={"action":"go.productDetail","params":{"productId":"e37a113be8eb47f7b1d9e332f9fc142b"},"sign":"848ef44c3d2745359aeccd96cadbdee5"}';
    var isWechat = /micromessenger/i.test(navigator.userAgent || '');
    
    if(isWechat){
        url = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.yoho&g_f=995445';
        location.href = url;
        
        document.getElementById("test").innerHTML="跳转到Safari打开";
    }
    
    var u = navigator.userAgent.toLowerCase();
    var isiOS = u.indexOf('os') > -1 || u.indexOf('iphone') > -1 || u.indexOf('mac') > -1 || u.indexOf('ipad') > -1;
    
    
    var androidExp = new RegExp('MQQBrowser');//安卓QQ内置浏览器正则
    var isAndroidQQ = androidExp.test(navigator.userAgent);  //判断是不是QQ内置浏览器
    
    var version, type, appid, td, params;
    
    params = queryString();
    
    if(params.union_type){
        url = 'yohobuy://yohobuy.com/goapp?ct='+params.union_type+'&openby:yohobuy={"action":"go.home","params":{"gender":"1","channel":"2"}}';
    }
    
    if (isiOS) {
        var regStr_saf = /os [\d._]*/gi;
        var verinfo = u.match(regStr_saf);
        
        version = (verinfo + '').replace(/[^0-9|_.]/ig, '').replace(/_/ig, '.');
        type = 'ios';
        appid = '1116559668';
        td = window.screen.width + '_' + window.screen.height + '_' + type + '_' + version;
        
    } else if (u.indexOf('android') > -1 || u.indexOf('linux') > -1) {
        type = 'android';
        appid = 'com.yoho';
        try {
            var indextd = u.indexOf('_td');
            var index = u.indexOf(' build');
            var preString = '';
            
            if (indextd > -1) {
                preString = u.substr(0, indextd);
                preString = preString.substr(preString.lastIndexOf(";") + 1);
                preString = preString.replace(/\s+/g, '').replace(/_/ig, '');
                
                var sansungIndex = preString.indexOf('samsung-');
                if (sansungIndex > -1) {
                    preString = preString.substr(8);
                }
            } else if (index > -1) {
                preString = u.substr(0, index);
                preString = preString.substr(preString.lastIndexOf(";") + 1);
                preString = preString.replace(/\s+/g, '').replace(/_/ig, '');
                //alert(preString);
            }
            deviceType = preString;
            version = u.substr(u.indexOf('android') + 8, 3);
            td = deviceType + '_' + type + '_' + version;
        } catch (e) {
            
        }
    }
    
    
    var appPath = url;
    var ifr;
    
    setTimeout(function () {
               //记录唤醒时间
               var openTime = +new Date();
               
               window.setTimeout(function () {
                                 if (ifr) {
                                 document.body.removeChild(ifr);
                                 }
                                 
                                 //如果setTimeout 回调超过2500ms，则弹出下载
                                 if ((+new Date()) - openTime > 500) {
                                 if (isiOS) {
                                 url = '//itunes.apple.com/us/app/id490655927?ls=1&mt=8';
                                 } else {
                                 url = '//yoho-apps.qiniudn.com/YohoBuy_YOHO.apk';
                                 }
                                 
                                 unionClick();
                                 
                                 location.href = url;
                                 // window.open(url);
                                 }
                                 }, 1000);
               
               if (isiOS) {
               window.location.href = appPath;
               } else {
               ifr = document.createElement('iframe');
               ifr.src = appPath;
               ifr.style.display = 'none';
               document.body.appendChild(ifr);
               }
               }, 500);
               
               //1: 男生，2-女生，3-潮童，4-创意生活
               var CHANNELS = {
                   boys: 1,
                   girls: 2,
                   kids: 3,
                   lifestyle: 4
               };
    
    function downloadApp() {
        var url;
        var channel = window.cookie('_Channel');
        
        if(isWechat){
            url = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.yoho&g_f=995445';
        }else{
            if (isiOS) {
                url = '//itunes.apple.com/us/app/id490655927?ls=1&mt=8';
            } else {
                if(isAndroidQQ){                  //安卓qq处理方式同微信，也进入应用宝下载
                    url = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.yoho&g_f=995445';
                }else{
                    url = '//yoho-apps.qiniudn.com/YohoBuy_YOHO.apk';
                }
            }
        }
        
        // 上报 nginx 数据
        xhrGet('//m.yohobuy.com/activitylog.json?download2', function () {
               });
               
               // 联盟点击
               if (params.union_type) {
                   unionClick();
               }
               
               location.href = url;
    }
    
    function unionClick() {
        var unionUrl = 'https://union.yoho.cn/union/ClickUnionRest/addUnion?client_type=' + type;
        //        var unionUrl = 'http://127.0.0.1:8088/union/ClickUnionRest/addUnion?client_type=' + type;
        if (params.union_type) {
            unionUrl += '&union_type=' + params.union_type;
        }
        if (params.identify_id) {
            unionUrl += '&identify_id=' + params.identify_id;
        }
        if (params.callbackurl) {
            unionUrl += '&callbackurl=' + params.callbackurl;
        }
        if (params.td) {
            unionUrl += '&td=' + params.td;
        } else {
            unionUrl += '&td=' + td;
        }
        if (params.appid) {
            unionUrl += '&appid=' + params.appid;
        } else {
            unionUrl += '&appid=' + appid;
        }
        if (params.idfa) {
            unionUrl += '&idfa=' + params.idfa;
        } else if (params.IDFA) {
            unionUrl += '&idfa=' + params.IDFA;
        }
        if (params.imei) {
            unionUrl += '&imei=' + params.imei;
        } else if (params.IMEI) {
            unionUrl += '&imei=' + params.IMEI;
        }
        xhrGet(unionUrl, function () {
               });
    }
    </script>
    <script>
        (function (w, d, s, j, f) {
         var a = d.createElement(s);
         var m = d.getElementsByTagName(s)[0];
         
         w.YohoAcquisitionObject = f;
         
         w[f] = function () {
         w[f].p = arguments;
         };
         
         a.async = 1;
         a.src = j;
         m.parentNode.insertBefore(a, m);
         }(window, document, 'script', (document.location.protocol === 'https:' ? 'https:' : 'http:') + '//cdn.yoho.cn/yas-jssdk/2.2.1/yas.js', '_yas'));
         

        </script>

</html>
